# 「書架空少年帰（Shosho）」サービス仕様書

## I. 設計思想とコンセプト

| 項目 | 仕様・目的 |
|---|---|
| サービス名 | 書架空少年帰（Shosho） |
| 目的 | Amazonの書籍購入の利便性と、リアル書店での**探索の楽しさ（セレンディピティ）**を融合させる。ユーザーの購買意欲を「価格や在庫」ではなく、「表紙や偶然の出会い」による純粋な興味で喚起する。 |
| 収益モデル | **Amazonアソシエイト（アフィリエイト）**に特化。サービス内で決済やカート機能は持たず、全ての購入はAmazonに誘導する。 |
| 初期コンテンツ | 人気少年漫画に限定する。「少年帰」のコンセプトとデータの取得・管理負荷軽減を両立させる。 |
| データ運用 | 一度登録した本の情報は、価格・在庫を問わず、原則として削除しない（本は増え続ける一方）。 |

## II. 技術スタック

| 項目 | 詳細 | 採用理由 |
|---|---|---|
| フロントエンド | 任意のフレームワーク（React, Vue, Svelteなど）/ WebGLライブラリ (Three.js/Unityなど) | 3D空間の表現と物理エンジンの実装のため。 |
| バックエンド | Cloudflare Workers (Hono) | 低コスト、サーバーレス、高速なグローバル分散処理を実現するため。 |
| データベース | Cloudflare D1 (SQLiteベース) | Workersとの連携が容易で、Amazonの静的データ保存に最適。 |
| データ取得 | Amazon Product Advertising API (PA-API) | 規約違反となるウェブスクレイピングを避け、公式なデータ取得ルートを確保するため。 |
| 定期実行 | Cloudflare Cron Triggers | PA-APIを定期的に叩き、新刊の追加や古い本の情報精査を実行するため。 |
| ホスティング | shosho.llll-ll.com | リポジトリ名とサブドメイン名の統一による管理の容易さ。 |

## III. 機能仕様：フロントエンド (UX)

### 1. バーチャル書店空間

| 機能 | 仕様詳細 | ノスタルジー演出 |
|---|---|---|
| 空間表現 | シンプルな3D空間（ローポリゴン、またはあえて粗いテクスチャ）で実装。 | レトロゲームや初期の3Dゲームのようなノスタルジックなインターフェースを意図的に採用。 |
| 書架移動 | 自由移動は不可。ユーザーが画面上のメニューやアイコンから**「棚（カテゴリ）」を選択**すると、カメラがその棚まで自動的に移動（ワープまたは自動歩行）。 | 操作を簡略化し、移動ストレスを軽減。アテンダントによる誘導を自然にする。 |
| 書架の構成 | 背表紙データは使用しない。すべての本は表紙を正面に向けて並べる。 | データ取得の手間を省き、**「表紙買い」**に特化させる。 |
| 書架カテゴリ | **「伝説の海賊棚」「秘密基地の棚」**など、少年心をくすぐるテーマで分類する。 |  |

### 2. 偶発的な出会い（ランダム要素）

| 機能 | 仕様詳細 |
|---|---|
| 物理落下場 | **「ランダム落下場」**などの特殊な空間を用意。D1に登録された全作品からランダムに抽出した本の表紙画像を、物理エンジンで床にまき散らす。 |
| 表紙の向き | 落下後、上になった面は必ず表紙画像が表示されるよう設定する。 |
| 操作 | ユーザーは自由に配置された表紙から偶然気に入ったものをクリックする。 |

### 3. ユーザーインターフェース

| 機能 | 仕様詳細 |
|---|---|
| アテンダント | 2Dの立ち絵を画面の左端に常に表示。移動時やイベント発生時に台詞で誘導や解説を行う。 |
| 本クリック時 | クリックした本に対し、タイトル、巻数、作者、表紙画像のみを表示。価格や在庫は一切表示しない。 |
| Amazon誘導 | クリックした詳細画面に**「Amazonで手に取る（購入）」ボタンを配置。ボタンには必ずトラッキングコード付きのアフィリエイトリンク**を仕込む。 |

## IV. データ仕様：D1とPA-API

### 1. D1データベースのテーブル構造（Booksテーブル）

| フィールド名 | データ型 | 説明 | 備考 |
|---|---|---|---|
| asin | TEXT (主キー) | Amazon Product ID。書籍を一意に特定。 | 必須 |
| title | TEXT | 書籍のタイトル。 | 必須 |
| volume | TEXT | シリーズの巻数情報。 |  |
| author | TEXT | 作者名。 | 必須 |
| image_url | TEXT | Amazonから取得した表紙画像のURL。 | 必須 |
| shelf_id | TEXT | 書架（カテゴリ）のID。例: pirate_shelf。 |  |
| link_tag | TEXT | ASINとトラッキングIDを組み合わせた最終的なアフィリエイトリンク。 |  |
| registered_at | DATETIME | D1に登録された日時。 | 更新頻度調整に利用。 |

### 2. バックエンドの更新ロジック

| 処理 | 実行頻度 | 目的 |
|---|---|---|
| 初期登録 | 手動/バッチ処理 | PA-API経由で少年漫画の主要なシリーズ（ASIN、タイトル、画像URLなど）をD1に一括登録。 |
| データ更新 | 週に一度 (Cron Triggers) | 新刊のASINを検索し、新規にD1に追加する。 |
| 価格/在庫 | 更新しない | 価格・在庫情報を含めないため、PA-APIへの日次リクエストは行わない。 |
| データ削除 | 不定期（手動検討） | 原則削除しないが、リンク切れが極端に多いなど、ユーザー体験を損なう場合のみ検討。 |
